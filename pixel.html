<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
  <style media="screen">
    body {
      background: black;
      text-align: center;
    }

    #c1 {
      background: white;
    }
  </style>
  <script>
    window.onload = function() {
      let oCanvas = document.getElementById('c1');
      let brush = oCanvas.getContext('2d');
      let oImage = new Image();
      let btn_gray = document.getElementById('btn_gray');
      let btn_yellow = document.getElementById('btn_yellow');
      let btn_magenta = document.getElementById('btn_magenta');
      oImage.src = 'universe.jpg';
      brush.drawImage(oImage, 0, 0);
      oImage.onload = function() {
        btn_gray.onclick = function() {
          brush.drawImage(oImage, 0, 0);
          let imageData = brush.getImageData(0, 0, oCanvas.width, oCanvas.height);
          for(r=0; r<oCanvas.height; r++){
            for(c=0; c<oCanvas.width; c++){
              let avg = (imageData.data[(r*oCanvas.width + c)*4] + imageData.data[(r*oCanvas.width + c)*4 + 1] + imageData.data[(r*oCanvas.width + c)*4 + 2]) /3;
              imageData.data[(r*oCanvas.width + c)*4] = imageData.data[(r*oCanvas.width + c)*4 + 1] = imageData.data[(r*oCanvas.width + c)*4 + 2] = avg;
            }
          }
          brush.putImageData(imageData, 0, 0);
        };
        btn_yellow.onclick = function() {
          brush.drawImage(oImage, 0, 0);
          let image_data = brush.getImageData(0, 0, oCanvas.width, oCanvas.height);
          for(let r=0; r<oCanvas.height; r++){
            for(let c=0; c<oCanvas.width; c++){
              image_data.data[(r*oCanvas.width+c)*4+2] = 0;
            }
          }
          brush.putImageData(image_data, 0, 0);
        };
        btn_magenta.onclick = function() {
          brush.drawImage(oImage, 0, 0);
          image_data = brush.getImageData(0, 0, oCanvas.width, oCanvas.height);
          for(let r=0; r<oCanvas.height; r++){
            for(let c=0; c<oCanvas.width; c++){
              image_data.data[(r*oCanvas.width+c)*4+1] = 0;
            }
          }
          brush.putImageData(image_data, 0, 0);
        };
      };
    };
  </script>
</head>

<body>
  <input type='button' value='变灰' id='btn_gray'></input>
  <input type='button' value='变黄' id='btn_yellow'></input>
  <input type='button' value='品红' id='btn_magenta'></input></br>
  <canvas id='c1' width='800' height='600'></canvas>
</body>

</html>
